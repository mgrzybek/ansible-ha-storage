---

# TODO: test with ZFS

- block:
#    - name: Wait for the mountpoint to be available
#      command: df
#      register: df_result
#      until: df_result.stdout.find(item.mountpoint) > -1
#      retries: 60
#      delay: 10

    - name: Set permissions to the mountpoint
      with_items: "{{ ha_storage.filesystems }}"
      when:
        - item.owner is defined
        - item.group is defined
        - item.mode is defined
      file:
        path: "{{ item.mountpoint }}"
        state: directory
        owner: "{{ item.owner | default('root') }}"
        group: "{{ item.group | default('root') }}"
        mode: "{{ item.mode | default('0755') }}" 
